@startuml Cross-Function Diagram
!theme plain
skinparam backgroundColor #FFFFFF

|User|
start
:Access Web Interface;
:Navigate to Live Camera;

|Web Browser|
:Load Main Page;
:Request Video Feed;

|Flask Web Server|
:Initialize Application;
:Start Camera Manager;
:Start Detection Thread;
:Start Health Monitor;

|Camera Manager|
:Initialize PiCamera2;
:Configure Streams (640x640);
:Start Video Streaming;

|Detection Thread|
:Load AI Models;
:Begin Frame Processing;

|Health Monitor|
:Begin System Monitoring;
:Log Health Status;

while (System Running?) is (Yes)
    |Camera Manager|
    :Capture Frame;
    :Process Frame (640x640);
    
    |Detection Thread|
    :Get Frame from Camera;
    :Detect Vehicles;
    
    if (Vehicle Detected?) then (Yes)
        :Save Vehicle Image;
        :Detect License Plates;
        
        if (License Plate Detected?) then (Yes)
            :Filter Valid Plates;
            :Draw Bounding Boxes;
            :Save Image with Boxes;
            :Crop License Plate;
            
            if (Plate Size >= 256x128?) then (Yes)
                :Resize to 256x128;
                :Hailo OCR Processing;
                
                if (OCR Successful?) then (Yes)
                    :Save OCR Result;
                else (No)
                    :EasyOCR Processing;
                    if (EasyOCR Successful?) then (Yes)
                        :Save OCR Result;
                    else (No)
                        :Log No Text Found;
                    endif
                endif
                
                |Database Manager|
                :Save Detection Result;
            else (No)
                :Skip OCR Processing;
            endif
        else (No)
            |Database Manager|
            :Save Vehicle Detection Only;
        endif
    else (No)
        :Continue to Next Frame;
    endif
    
    |Health Monitor|
    :Check System Health;
    :Log Health Status;
    
    |Flask Web Server|
    :Serve Video Feed;
    :Handle API Requests;
    
    |Web Browser|
    :Display Video Feed;
    :Update UI Status;
    
    :Wait for Next Frame;
endwhile (No)

|Flask Web Server|
:Shutdown Application;
:Stop All Threads;

|Camera Manager|
:Stop Camera;
:Release Resources;

|Database Manager|
:Close Connections;

stop

@enduml
